/*
 * uBlaze0.c
 *
 *  Created on: 16 May 2022
 *      Author: berke
 */


#include "xparameters.h"
#include "xbram.h"
#include <stdio.h>

#define BRAM_DEVICE_ID		XPAR_BRAM_0_DEVICE_ID

static void InitializeECC(XBram_Config *ConfigPtr, u32 EffectiveAddr);




XBram Bram;	/* The Instance of the BRAM Driver */

void main()
{
	XBram_Config *ConfigPtr;
	ConfigPtr = XBram_LookupConfig(BRAM_DEVICE_ID);
	XBram_CfgInitialize(&Bram, ConfigPtr, ConfigPtr->CtrlBaseAddress);

	InitializeECC(ConfigPtr, ConfigPtr->CtrlBaseAddress);




}

void InitializeECC(XBram_Config *ConfigPtr, u32 EffectiveAddr)
{
	u32 Addr;
	volatile u32 Data;

	if (ConfigPtr->EccPresent &&
	    ConfigPtr->EccOnOffRegister &&
	    ConfigPtr->EccOnOffResetValue == 0 &&
	    ConfigPtr->WriteAccess != 0) {
		for (Addr = ConfigPtr->MemBaseAddress;
		     Addr < ConfigPtr->MemHighAddress; Addr+=4) {
			Data = XBram_In32(Addr);
			XBram_Out32(Addr, Data);
		}
		XBram_WriteReg(EffectiveAddr, XBRAM_ECC_ON_OFF_OFFSET, 1);
	}
}
